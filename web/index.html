<!DOCTYPE html>

<html lang="ru">
<head>
<meta charset="UTF-8">
<title>Sales Tracker</title>
<style>
    body {
        font-family: Arial, sans-serif;
        background-color: #f6f6f6;
        margin: 0;
        padding: 0;
        color: #222;
    }
    header {
        background-color: #0033a0; /* синий */
        color: white;
        padding: 1rem;
        text-align: center;
    }
    .container {
        max-width: 900px;
        margin: 2rem auto;
        background-color: #ffffff; /* белый */
        padding: 1.5rem;
        border-radius: 8px;
        box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }
    h2 {
        color: #d52b1e; /* красный */
        margin-top: 0;
    }
    table {
        width: 100%;
        border-collapse: collapse;
        margin-bottom: 1rem;
    }
    table th, table td {
        border: 1px solid #ccc;
        padding: 0.5rem;
        text-align: left;
    }
    table th {
        background-color: #e5e5e5;
    }
    .btn {
        padding: 0.4rem 0.8rem;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        margin-right: 0.5rem;
        background-color: #0033a0;
        color: white;
    }
    .btn:hover {
        opacity: 0.85;
    }
    form input, form select {
        padding: 0.4rem;
        margin-right: 0.5rem;
        margin-bottom: 0.5rem;
        border-radius: 4px;
        border: 1px solid #ccc;
    }
</style>
</head>
<body>
<header>
    <h1>Sales Tracker</h1>
</header>
<div class="container">
    <h2>Добавить транзакцию</h2>
    <form id="transactionForm">
        <input type="text" id="name" placeholder="Название" required>
        <input type="text" id="description" placeholder="Описание">
        <input type="number" step="0.01" id="amount" placeholder="Сумма" required>
        <select id="type" required>
            <option value="">Выберите тип</option>
            <option value="expense">Расход</option>
            <option value="income">Доход</option>
        </select>
        <input type="text" id="category" placeholder="Категория">
        <input type="date" id="event_date" required>
        <button type="submit" class="btn">Добавить</button>
    </form>

```
<h2>Транзакции</h2>
<button class="btn" onclick="loadTransactions()">Обновить список</button>
<button class="btn" onclick="exportCSV()">Скачать CSV</button>
<table id="transactionsTable">
    <thead>
        <tr>
            <th>ID</th>
            <th>Название</th>
            <th>Описание</th>
            <th>Сумма</th>
            <th>Тип</th>
            <th>Категория</th>
            <th>Дата</th>
        </tr>
    </thead>
    <tbody></tbody>
</table>

<h2>Аналитика</h2>
<button class="btn" onclick="loadAnalytics()">Обновить</button>
<div id="analytics"></div>
```

</div>

<script>
const apiBase = '';

document.getElementById('transactionForm').addEventListener('submit', async (e) => {
    e.preventDefault();
    const data = {
        name: document.getElementById('name').value,
        description: document.getElementById('description').value,
        amount: parseFloat(document.getElementById('amount').value),
        type: document.getElementById('type').value,
        category: document.getElementById('category').value,
        event_date: document.getElementById('event_date').value
    };
    const res = await fetch(apiBase + '/items', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify(data)
    });
    if(res.ok){
        alert('Транзакция добавлена!');
        loadTransactions();
    } else {
        const err = await res.json();
        alert('Ошибка: ' + err.error);
    }
});

async function loadTransactions() {
    const res = await fetch(apiBase + '/items');
    const data = await res.json();
    const tbody = document.querySelector('#transactionsTable tbody');
    tbody.innerHTML = '';
    data.forEach(t => {
        const tr = document.createElement('tr');
        tr.innerHTML = `<td>${t.id}</td>
                        <td>${t.name}</td>
                        <td>${t.description}</td>
                        <td>${t.amount}</td>
                        <td>${t.type}</td>
                        <td>${t.category}</td>
                        <td>${t.event_date}</td>`;
        tbody.appendChild(tr);
    });
}

async function loadAnalytics() {
    const res = await fetch(apiBase + '/analytics');
    const data = await res.json();
    document.getElementById('analytics').innerHTML = `
        <p>Сумма: ${data.sum}</p>
        <p>Среднее: ${data.avg}</p>
        <p>Медиана: ${data.median}</p>
        <p>90-й процентиль: ${data.percentile90}</p>
        <p>Количество: ${data.count}</p>
    `;
}

async function exportCSV() {
    const res = await fetch(apiBase + '/items/export');
    if(!res.ok) {
        alert('Ошибка при экспорте CSV');
        return;
    }
    const blob = await res.blob();
    const url = window.URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'transactions.csv';
    a.click();
}
</script>

</body>
</html>
